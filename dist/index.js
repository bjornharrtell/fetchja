import q from"pluralize";function c(t){if(Array.isArray(t))return t.map(c);let e={id:t.id,type:t.type};for(let r in t.attributes)e[r]=t.attributes[r];for(let r in t.relationships)t.relationships[r].data&&(e[r]=t.relationships[r].data);return e}function z(t){let e={};for(let r of t)e[r.type]||(e[r.type]={}),e[r.type][r.id]=c(r);return e}function f(t){let e={};if(t.data&&(e.data=c(t.data)),t.meta&&(e.meta=t.meta),t.included){let r=z(t.included),i=s=>r[s.type][s.id];for(let s of e.data)for(let a in s){let o=s[a];typeof o=="object"&&(s[a]=Array.isArray(o)?o.map(i):i(o))}}return e}function n(t){if(t.response){let{data:e}=t.response;e?.errors&&(t.errors=e.errors)}throw t}function g(t,e,r){return typeof t=="object"&&t!==null?(r.relationships||(r.relationships={}),r.relationships[e]={data:t.id?{id:t.id,type:t.type||e}:t,links:t.links,meta:t.meta}):(r.attributes||(r.attributes={}),r.attributes[e]=t),r}function y(t,e,r={camelCaseTypes:i=>i,pluralTypes:i=>i}){try{if(e===null||Array.isArray(e)&&!e.length)return{data:e};let i={type:r.pluralTypes(r.camelCaseTypes(t))};e.id&&(i.id=String(e.id));for(let s in e)["id","type"].includes(s)||g(e[s],s,i);return JSON.stringify({data:i})}catch(i){n(i)}}function m(t,e={},r=""){let i=Array.isArray(e);for(let s in e){let a=e[s],o=r?`${r}[${i?"":s}]`:s;a instanceof Object?m(t,a,o):t.append(o,a)}}function d(t={}){let e=new URLSearchParams;return m(e,t),e}function C(t,e={resourceCase:r=>r,pluralize:r=>r}){let r=t.split("/"),i=r.pop(),s=r.join("/");return[i,`${s}/${e.pluralize(e.resourceCase(i))}`]}function l(t){return t.toLowerCase().replace(/[-_](.)/g,(e,r)=>r.toUpperCase()).replace(/^(.)/,e=>e.toLowerCase())}function b(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/_/g,"-").toLowerCase()}function T(t){return t.replace(/([a-z])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}var p="application/vnd.api+json",h=class{constructor(e={headers:{}}){this.baseURL=e.baseURL,this.headers={Accept:p,"Content-Type":p,...e.headers},this.queryFormatter=typeof e.queryFormatter=="function"?e.queryFormatter:i=>d(i),this.camelCaseTypes=e.camelCaseTypes===!1?i=>i:l;let r={camel:l,kebab:b,snake:T,default:i=>i};this.resourceCase=r[e.resourceCase]||r.default,this.pluralize=e.pluralize===!1?i=>i:q,this.onResponseError=i=>i,this.fetch=this.get,this.update=this.patch,this.create=this.post,this.remove=this.delete}#e(e){return C(e,{resourceCase:this.resourceCase,pluralize:this.pluralize})}async request(e={method:"GET",headers:{}}){let r=new URL(e.url,this.baseURL||e.baseURL);e.params&&(r.search=this.queryFormatter(e.params)),e.body&&(e.body=y(e.type,e.body,{camelCaseTypes:this.camelCaseTypes,pluralTypes:this.pluralize}));let i=()=>{let s=new Headers({...this.headers,...e.headers});return fetch(r,{method:e.method,body:e.body,headers:s})};try{let s=await i();if(s.ok){if(!s.ok)throw new Error(s.statusText)}else{s.replayRequest=i;let u=await this.onResponseError(s);u instanceof Response&&(s=u)}let a={};for(let[u,k]of s.headers.entries())a[u]=k;let o=a["content-type"],w=o&&o.includes(p)?await s.json():{};return{...f(w),status:s.status,statusText:s.statusText,headers:a}}catch(s){throw s}}get(e,r={method:"GET"}){try{return r.url=e.split("/").map(i=>this.resourceCase(i)).filter(Boolean).join("/"),this.request(r)}catch(i){throw n(i)}}patch(e,r,i={method:"PATCH"}){try{let[s,a]=this.#e(e);return this.request({url:r?.id?`${a}/${r.id}`:a,body:r,type:s,...i})}catch(s){throw n(s)}}post(e,r,i={method:"POST"}){try{let[s,a]=this.#e(e);return this.request({url:a,body:r,type:s,...i})}catch(s){throw n(s)}}delete(e,r,i={method:"DELETE"}){try{let[s,a]=this.#e(e);return this.request({url:`${a}/${r}`,body:{id:r},type:s,...i})}catch(s){throw n(s)}}};export{h as default};
//# sourceMappingURL=index.js.map
