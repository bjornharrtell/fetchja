import q from"pluralize";function l(t){if(Array.isArray(t))return t.map(l);let e={id:t.id,type:t.type};for(let r in t.attributes)e[r]=t.attributes[r];for(let r in t.relationships)t.relationships[r].data&&(e[r]=t.relationships[r].data);return e}function A(t){let e={};for(let r of t)e[r.type]||(e[r.type]={}),e[r.type][r.id]=l(r);return e}function p(t){return typeof t=="object"&&t!==null}function m(t){let e={};if(t.data&&(e.data=l(t.data)),t.meta&&(e.meta=t.meta),t.included){let r=A(t.included),s=i=>i.type in r?r[i.type][i.id]:i,a=i=>Array.isArray(i)?i.map(s):s(i);for(let i in r)for(let o in r[i])for(let u in r[i][o]){let n=r[i][o][u];p(n)&&(r[i][o][u]=a(n))}if(Array.isArray(e.data))for(let i of e.data)for(let o in i)p(i[o])&&(i[o]=a(i[o]));else if(p(e.data))for(let i in e.data)p(e.data[i])&&(e.data[i]=a(e.data[i]))}return e}function c(t){if(t.response){let{data:e}=t.response;e?.errors&&(t.errors=e.errors)}throw t}function g(t,e,r){return typeof t=="object"&&t!==null?(r.relationships||(r.relationships={}),r.relationships[e]={data:t.id?{id:t.id,type:t.type||e}:t,links:t.links,meta:t.meta}):(r.attributes||(r.attributes={}),r.attributes[e]=t),r}function d(t,e,r={camelCaseTypes:s=>s,pluralTypes:s=>s}){try{if(e===null||Array.isArray(e)&&!e.length)return{data:e};let s={type:r.pluralTypes(r.camelCaseTypes(t))};e.id&&(s.id=String(e.id));for(let a in e)["id","type"].includes(a)||g(e[a],a,s);return JSON.stringify({data:s})}catch(s){c(s)}}function C(t,e={},r=""){let s=Array.isArray(e);for(let a in e){let i=e[a],o=r?`${r}[${s?"":a}]`:a;i instanceof Object?C(t,i,o):t.append(o,i)}}function b(t={}){let e=new URLSearchParams;return C(e,t),e}function T(t,e={resourceCase:r=>r,pluralize:r=>r}){let r=t.split("/"),s=r.pop(),a=r.join("/");return[s,`${a}/${e.pluralize(e.resourceCase(s))}`]}function f(t){return t.toLowerCase().replace(/[-_](.)/g,(e,r)=>r.toUpperCase()).replace(/^(.)/,e=>e.toLowerCase())}function w(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/_/g,"-").toLowerCase()}function k(t){return t.replace(/([a-z])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}var h="application/vnd.api+json",y=class{constructor(e={headers:{}}){this.baseURL=e.baseURL,this.headers={Accept:h,"Content-Type":h,...e.headers},this.queryFormatter=typeof e.queryFormatter=="function"?e.queryFormatter:s=>b(s),this.camelCaseTypes=e.camelCaseTypes===!1?s=>s:f;let r={camel:f,kebab:w,snake:k,default:s=>s};this.resourceCase=r[e.resourceCase]||r.default,this.pluralize=e.pluralize===!1?s=>s:q,this.onResponseError=s=>s,this.fetch=this.get,this.update=this.patch,this.create=this.post,this.remove=this.delete}#e(e){return T(e,{resourceCase:this.resourceCase,pluralize:this.pluralize})}async request(e={method:"GET",headers:{}}){let r=new URL(e.url,this.baseURL||e.baseURL);e.params&&(r.search=this.queryFormatter(e.params)),e.body&&(e.body=d(e.type,e.body,{camelCaseTypes:this.camelCaseTypes,pluralTypes:this.pluralize}));let s=()=>{let a=new Headers({...this.headers,...e.headers});return fetch(r,{method:e.method,body:e.body,headers:a})};try{let a=await s();if(a.ok){if(!a.ok)throw new Error(a.statusText)}else{a.replayRequest=s;let n=await this.onResponseError(a);n instanceof Response&&(a=n)}let i={};for(let[n,z]of a.headers.entries())i[n]=z;let o=i["content-type"],u=o&&o.includes(h)?await a.json():{};return{...m(u),status:a.status,statusText:a.statusText,headers:i}}catch(a){throw a}}get(e,r={method:"GET"}){try{return r.url=e.split("/").map(s=>this.resourceCase(s)).filter(Boolean).join("/"),this.request(r)}catch(s){throw c(s)}}patch(e,r,s={method:"PATCH"}){try{let[a,i]=this.#e(e);return this.request({url:r?.id?`${i}/${r.id}`:i,body:r,type:a,...s})}catch(a){throw c(a)}}post(e,r,s={method:"POST"}){try{let[a,i]=this.#e(e);return this.request({url:i,body:r,type:a,...s})}catch(a){throw c(a)}}delete(e,r,s={method:"DELETE"}){try{let[a,i]=this.#e(e);return this.request({url:`${i}/${r}`,body:{id:r},type:a,...s})}catch(a){throw c(a)}}};export{y as default};
//# sourceMappingURL=index.js.map
