import x from"pluralize";function p(t){if(Array.isArray(t))return t.map(p);let e={id:t.id,type:t.type};for(let r in t.attributes)e[r]=t.attributes[r];for(let r in t.relationships)t.relationships[r].data&&(e[r]=t.relationships[r].data);return e}function g(t){let e={};for(let r of t)e[r.type]||(e[r.type]={}),e[r.type][r.id]=p(r);return e}function f(t){return typeof t=="object"&&t!==null}function d(t){let e={};if(t.data&&(e.data=p(t.data)),t.meta&&(e.meta=t.meta),t.included){let r=g(t.included),a=s=>s.type in r?r[s.type][s.id]:s,i=s=>Array.isArray(s)?s.map(a):a(s);for(let s in r)for(let o in r[s])for(let u in r[s][o]){let c=r[s][o][u];f(c)&&(r[s][o][u]=i(c))}if(Array.isArray(e.data))for(let s of e.data)for(let o in s)f(s[o])&&(s[o]=i(s[o]));else if(f(e.data))for(let s in e.data)f(e.data[s])&&(e.data[s]=i(e.data[s]))}return e}function n(t){if(t.response){let{data:e}=t.response;e?.errors&&(t.errors=e.errors)}throw t}function q(t,e,r){return typeof t=="object"&&t!==null?(r.relationships||(r.relationships={}),r.relationships[e]={data:t.id?{id:t.id,type:t.type||e}:t,links:t.links,meta:t.meta}):(r.attributes||(r.attributes={}),r.attributes[e]=t),r}function C(t,e,r={camelCaseTypes:a=>a,pluralTypes:a=>a}){try{if(e===null||Array.isArray(e)&&!e.length)return{data:e};let a={type:r.pluralTypes(r.camelCaseTypes(t))};e.id&&(a.id=String(e.id));for(let i in e)["id","type"].includes(i)||q(e[i],i,a);return JSON.stringify({data:a})}catch(a){n(a)}}function b(t,e={},r=""){let a=Array.isArray(e);for(let i in e){let s=e[i],o=r?`${r}[${a?"":i}]`:i;s instanceof Object?b(t,s,o):t.append(o,s)}}function T(t={}){let e=new URLSearchParams;return b(e,t),e}function w(t,e={resourceCase:r=>r,pluralize:r=>r}){let r=t.split("/"),a=r.pop(),i=r.join("/");return[a,`${i}/${e.pluralize(e.resourceCase(a))}`]}function h(t){return t.toLowerCase().replace(/[-_](.)/g,(e,r)=>r.toUpperCase()).replace(/^(.)/,e=>e.toLowerCase())}function k(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/_/g,"-").toLowerCase()}function z(t){return t.replace(/([a-z])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}var y="application/vnd.api+json",m=class{constructor(e={headers:{}}){this.baseURL=e.baseURL,this.headers={Accept:y,"Content-Type":y,...e.headers},this.queryFormatter=typeof e.queryFormatter=="function"?e.queryFormatter:a=>T(a),this.camelCaseTypes=e.camelCaseTypes===!1?a=>a:h;let r={camel:h,kebab:k,snake:z,default:a=>a};this.resourceCase=r[e.resourceCase]||r.default,this.pluralize=e.pluralize===!1?a=>a:x,this.onResponseError=a=>a,this.fetch=this.get,this.update=this.patch,this.create=this.post,this.remove=this.delete}#e(e){return w(e,{resourceCase:this.resourceCase,pluralize:this.pluralize})}async request(e={method:"GET",headers:{}}){let r=this.baseURL||e.baseURL,a=new URL(e.url.startsWith("/")?e.url.slice(1):e.url,r.endsWith("/")?r:r+"/");e.params&&(a.search=this.queryFormatter(e.params)),e.body&&(e.body=C(e.type,e.body,{camelCaseTypes:this.camelCaseTypes,pluralTypes:this.pluralize}));let i=()=>{let s=new Headers({...this.headers,...e.headers});return fetch(a,{method:e.method,body:e.body,headers:s})};try{let s=await i();if(s.ok){if(!s.ok)throw new Error(s.statusText)}else{s.replayRequest=i;let l=await this.onResponseError(s);l instanceof Response&&(s=l)}let o={};for(let[l,A]of s.headers.entries())o[l]=A;let u=o["content-type"],c=u&&u.includes(y)?await s.json():{};return{...c.errors?c:d(c),status:s.status,statusText:s.statusText,headers:o}}catch(s){throw s}}get(e,r={method:"GET"}){try{return r.url=e.split("/").map(a=>this.resourceCase(a)).filter(Boolean).join("/"),this.request(r)}catch(a){throw n(a)}}patch(e,r,a={method:"PATCH"}){try{let[i,s]=this.#e(e);return this.request({url:r?.id?`${s}/${r.id}`:s,body:r,type:i,...a})}catch(i){throw n(i)}}post(e,r,a={method:"POST"}){try{let[i,s]=this.#e(e);return this.request({url:s,body:r,type:i,...a})}catch(i){throw n(i)}}delete(e,r,a={method:"DELETE"}){try{let[i,s]=this.#e(e);return this.request({url:`${s}/${r}`,body:{id:r},type:i,...a})}catch(i){throw n(i)}}};export{m as default};
//# sourceMappingURL=index.js.map
