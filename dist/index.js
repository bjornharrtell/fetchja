import x from"pluralize";function n(t){if(Array.isArray(t))return t.map(n);let e={id:t.id,type:t.type};for(let r in t.attributes)e[r]=t.attributes[r];for(let r in t.relationships)t.relationships[r].data&&(e[r]=t.relationships[r].data);return e}function g(t){let e={};for(let r of t)e[r.type]||(e[r.type]={}),e[r.type][r.id]=n(r);return e}function h(t){let e={};if(t.data&&(e.data=n(t.data)),t.meta&&(e.meta=t.meta),t.included){let r=g(t.included),s=i=>r[i.type][i.id];for(let i of e.data)for(let o in i){let a=i[o];typeof a=="object"&&(i[o]=Array.isArray(a)?a.map(s):s(a))}}return e}function c(t){if(t.response){let{data:e}=t.response;e?.errors&&(t.errors=e.errors)}throw t}function k(t,e,r){return typeof t=="object"&&t!==null?(r.relationships||(r.relationships={}),r.relationships[e]={data:t.id?{id:t.id,type:t.type||e}:t,links:t.links,meta:t.meta}):(r.attributes||(r.attributes={}),r.attributes[e]=t),r}function f(t,e,r={camelCaseTypes:s=>s,pluralTypes:s=>s}){try{if(e===null||Array.isArray(e)&&!e.length)return{data:e};let s={type:r.pluralTypes(r.camelCaseTypes(t))};e.id&&(s.id=String(e.id));for(let i in e)["id","type"].includes(i)||k(e[i],i,s);return JSON.stringify({data:s})}catch(s){c(s)}}function y(t,e={},r=""){let s=Array.isArray(e);for(let i in e){let o=e[i],a=r?`${r}[${s?"":i}]`:i;o instanceof Object?y(t,o,a):t.append(a,o)}}function m(t={}){let e=new URLSearchParams;return y(e,t),e}function d(t,e={resourceCase:r=>r,pluralize:r=>r}){let r=t.split("/"),s=r.pop(),i=r.join("/");return[s,`${i}/${e.pluralize(e.resourceCase(s))}`]}function u(t){return t.toLowerCase().replace(/[-_](.)/g,(e,r)=>r.toUpperCase()).replace(/^(.)/,e=>e.toLowerCase())}function C(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/_/g,"-").toLowerCase()}function b(t){return t.replace(/([a-z])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}var l="application/vnd.api+json",p=class{constructor(e={headers:{}}){this.baseURL=e.baseURL,this.headers={Accept:l,"Content-Type":l,...e.headers},this.queryFormatter=typeof e.queryFormatter=="function"?e.queryFormatter:s=>m(s),this.camelCaseTypes=e.camelCaseTypes===!1?s=>s:u;let r={camel:u,kebab:C,snake:b,default:s=>s};this.resourceCase=r[e.resourceCase]||r.default,this.pluralize=e.pluralize===!1?s=>s:x,this.onResponseError=s=>s,this.fetch=this.get,this.update=this.patch,this.create=this.post,this.remove=this.delete}#e(e){return d(e,{resourceCase:this.resourceCase,pluralize:this.pluralize})}async request(e={method:"GET",headers:{}}){let r=new URL(e.url,this.baseURL||e.baseURL);e.params&&(r.search=this.queryFormatter(e.params));let s=new Headers({...this.headers,...e.headers});e.body&&(e.body=f(e.type,e.body,{camelCaseTypes:this.camelCaseTypes,pluralTypes:this.pluralize}));try{let i=await fetch(r,{method:e.method,body:e.body,headers:s});if(!i.ok)throw this.onResponseError(i),new Error(i.statusText);let o={};for(let[w,z]of i.headers.entries())o[w]=z;let a=o["content-type"],T=a&&a.includes(l)?await i.json():{};return{...h(T),status:i.status,statusText:i.statusText,headers:o}}catch(i){throw i}}get(e,r={method:"GET"}){try{return r.url=e.split("/").map(s=>this.resourceCase(s)).filter(Boolean).join("/"),this.request(r)}catch(s){throw c(s)}}patch(e,r,s={method:"PATCH"}){try{let[i,o]=this.#e(e);return this.request({url:r?.id?`${o}/${r.id}`:o,body:r,type:i,...s})}catch(i){throw c(i)}}post(e,r,s={method:"POST"}){try{let[i,o]=this.#e(e);return this.request({url:o,body:r,type:i,...s})}catch(i){throw c(i)}}delete(e,r,s={method:"DELETE"}){try{let[i,o]=this.#e(e);return this.request({url:`${o}/${r}`,body:{id:r},type:i,...s})}catch(i){throw c(i)}}};export{p as default};
//# sourceMappingURL=index.js.map
